<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Androidgrl's Blog &middot; About 3D Printing & Tech, by Jamie Kawahara
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0e">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
      <img src="./public/githubphoto.jpeg">Androidgrl</img>
      <p>Hello!  Welcome to androidgrl's blog!  My name is Jamie Kawahara I am a software developer and 3D printing enthusiast.  I hope you find the tutorials helpful.</p>
      <a href="https://twitter.com/androidgrl">Twitter</a></br>
      <a href="https://github.com/androidgrl">Github</a>
  </div>

  <nav class="sidebar-nav">

    

    
    
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2017. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Androidgrl's Blog</a>
            <small>About 3D Printing & Tech, by Jamie Kawahara</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2017/01/04/demeter/">
        Law of Demeter
      </a>
    </h1>

    <span class="post-date">04 Jan 2017</span>

    <p>A few times I’ve been told during code review that something violates the Law of Demeter.  This method for example.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class User
  def user_info
    "#{user.name}, #{user.department.name}"
  end
end
</code></pre>
</div>

<p>Which led me to ask: what is the Law of Demeter, why should I follow it, how do I know if I’m violating it, and how do I avoid violating it?</p>

<p>The Law of Demeter is formally defined as,</p>

<div class="highlighter-rouge"><pre class="highlight"><code>A method of an object may only call methods of:
  The object itself.
  An argument of the method.
  Any object created within the method.
  Any direct properties/fields of the object.
</code></pre>
</div>

<p>The above code sample violates the law with “user.department.name” because it’s calling name on the user’s department, and department is an entirely different object from a user.</p>

<p>In general it is better if one class does not have to know about methods from another class, in other words when the classes are “decoupled”.  This is because it makes the code more flexible.  For example in our code sample, there is only one department for a user.  But what happens if things changed so that a user could have many departments and we wanted the only use the first one for our user_info method?  We would then have to say:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class User
  def user_info
    "#{user.name}, #{user.departments.first.name}"
  end
end
</code></pre>
</div>

<p>This seems reasonable for now but what if we used “user.department” in multiple places?  We’d have to make the same change wherever it was used, which would be cumbersome.</p>

<p>So how do you avoid violating the law?</p>

<p>You could make a custom method in the User class called “department_name”:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class User
  def user_info
    "#{user.name}, #{user.department_name}"
  end

  def department_name
    departments.first.name
  end
end
</code></pre>
</div>

<p>Now the department_name is an immediate property of the user itself, satisfying the law and also making it easier to make future changes if we want to change what we use for the department’s name.</p>

<p>One sign that is often but not always an indication of Demeter violation is chaining of dots.  For example “user.departments.first.name” had chained dots and indeed was a violation.  However, sometimes dot chaining does not mean Demeter violation for example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>def slug(string)
  string.strip.downcase.tr_s('^[a-z0-9]', '-')
end
</code></pre>
</div>

<p>The above complies with the Law of Demeter because each method is called on a String object.  And the law doesn’t care about the number of methods called, but the number of <em>types</em> of methods called.</p>

<p>For more information see <a href="http://www.virtuouscode.com/2011/07/05/demeter-its-not-just-a-good-idea-its-the-law/">Demeter: It’s not just a good idea. It’s the law.</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2017/01/03/ag/">
        Refining Searches using Ag
      </a>
    </h1>

    <span class="post-date">03 Jan 2017</span>

    <p>I use Ag a lot to search for keywords in Rails Apps.  However sometimes a keyword is present so often that I want to refine my search.  One example of this is if I want to search for a keyword present only in test files. Ag has a useful -G flag that allows you to do this.</p>

<p>For example say I wanted to search for the keyword “organization” in files that end in spec.rb.  I would use:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&gt; Ag organization -G spec.rb$
</code></pre>
</div>

<p>The -G flag tells Ag to look for the term inside files with names containing spec.rb.  It can accept a regex which is what the $ is for.  The $ indicates that I want to search in files that end in spec.rb, not just files that have spec.rb somewhere within their names.</p>

<p>Another example is if I am searching for a keyword that includes punctuation marks which happen to be regex characters.  For example, I was searching for “.try” and since Ag automatically treats search terms as regexes by default, it will find all terms with any character followed by try, like “retry” in addition to “.try”.</p>

<p>Ag has a literal expression flag -Q to specify that you’re searching for a literal expression not a regex.  In order to search for “.try” you would use:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&gt; Ag -Q .try
</code></pre>
</div>

<p>For more  information see <a href="http://conqueringthecommandline.com/book/ack_ag">Conquering the Command Line, by Mark Bates</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2016/08/30/rescue/">
        How to Raise and Rescue Errors in Rails
      </a>
    </h1>

    <span class="post-date">30 Aug 2016</span>

    <p>Raising and rescuing errors in Rails is relatively easy.  All you need to do is make a custom error class, raise it (usually in a model) and rescue it (usually in a controller).</p>

<p>Start by making a custom error class that inherits from StandardError.  This will give you a more descriptive error instead of raising the generic StandardError, so you can better deduce where the error came from.
 I will use a hypothetical example of an error that is raised when a User is being created.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class UserCreateError &lt; StandardError
end
</code></pre>
</div>

<p>Each custom error class should have it’s own file which you can put in an app/errors directory.</p>

<p>Here I will raise the error in a User model method.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class User &lt; ActiveRecord::Base
  def self.example_method
    raise UserCreateError
  end
end
</code></pre>
</div>

<p>When the create action is called on the controller, it will call User.example_method, which will raise the error.  The error then goes back up to the controller where it is rescued.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class UsersController &lt; ApplicationController
  def create
    User.example_method
  rescue UserCreateError
    render json: "Invalid User Information", status: :bad_request
  end
end
</code></pre>
</div>

<p>Note the indentation of the rescue is on the same column as the def.</p>

<p>Whatever you put underneath the rescue will be run if there is an error.</p>

<p>Here I render a custom json error message and specify an optional status code.</p>

<p>And that’s pretty much all there is too it.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2016/07/15/initialize/">
        What is initialize used for in Ruby?
      </a>
    </h1>

    <span class="post-date">15 Jul 2016</span>

    <p>Does initialize need to be used all the time in a class?  No.
You only need it to set instance variables and to allow passing of arguments when instantiating a class.</p>

<p><strong>Example one:</strong> <em>You don’t need it to instantiate a class</em></p>

<p>Let’s make a class with a single instance method and no initialize method.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class Holiday
  def statement
    "I'm going to the beach"
  end
end
puts Holiday.new
puts Holiday.new.statement
</code></pre>
</div>

<p>If we run the code, the “puts” outputs the following, and we see that Holiday.new instantiates an object just fine and we can call the method statement on it:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#&lt;Holiday:0x007fe194093d00&gt;
I'm going to the beach
</code></pre>
</div>

<p><strong>Example two:</strong> <em>You don’t need it to use attr_accessors</em></p>

<p>Let’s make a class with an attr_accessor and no initialize method.  We instantiate two different holiday objects, and then using the attr_accessors set a separate location attribute for each.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class Holiday
  attr_accessor :location
  def statement
    "I'm going on holiday to #{location}"
  end
end
holiday1 = Holiday.new
holiday2 = Holiday.new
holiday1.location = "Europe"
holiday2.location = "Hawaii"
puts holiday1.statement
puts holiday2.statement
</code></pre>
</div>

<p>The output shows that the attr_accessors still work without the initialize method.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>I'm going on holiday to Europe
I'm going on holiday to Hawaii
</code></pre>
</div>

<p><strong>Example three:</strong> <em>You DO need it to set instance variables</em></p>

<p>The following is a class that tries to set an instance variable @word to equal “whatever”.
The output is nothing, because instance variables need to be put inside an initialize method.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class Random
  @word = "whatever"
  def whatever
    @word
  end
end
puts Random.new.whatever
</code></pre>
</div>

<p>The following will correctly result in an output of “whatever”.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class Random
  def initialize
    @word = "whatever"
  end
  def whatever
    @word
  end
end
puts Random.new.whatever
</code></pre>
</div>

<p><strong>Example four:</strong> <em>You DO need it to allow arguments to be passed in when instantiating a Class</em></p>

<p>The following code tries to pass in a string argument into the “new” method.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class Random
end

puts Random.new("whatever")
</code></pre>
</div>

<p>This results in an error.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>new.rb:35:in `initialize': no implicit conversion of String into Integer (TypeError)
        from new.rb:35:in `new'
        from new.rb:35:in `&lt;main&gt;'
</code></pre>
</div>

<p>You need to specify that there are arguments in the initialize method for “new” method to be able to take any.
However, you don’t have to actually do anything with the arguments in the initialize method.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class Random
  def initialize(word)
  end
end

puts Random.new("whatever")
</code></pre>
</div>

<p>This will result in the object being successfully instantiated, as shown in the output below.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#&lt;Random:0x007fbbb9170cd8&gt;
</code></pre>
</div>

<p>If you wanted to actually have access to the attribute then you would have to set it as an instance variable inside the initialize method, and set an attr_reader.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class Random
  attr_reader :word
  def initialize(word)
    @word = word
  end
end

puts Random.new("whatever").word
</code></pre>
</div>

<p>Which will output “whatever”.</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2016/07/13/double/">
        The difference between Rspec spies, doubles and instance_doubles
      </a>
    </h1>

    <span class="post-date">13 Jul 2016</span>

    <p>Throughout the code base of our Rails app at work, we have many Rspec tests that use spies, doubles and instance_doubles.  I found most of the information on the web about them to be very theoretical and not practical.  My coworker then explained it to me very clearly as follows:</p>

<ol>
  <li>
    <p>All three terms belong under an umbrella term called “doubles”. In other words, a spy is a type of double, and so is an instance_double.</p>
  </li>
  <li>
    <p>Spies, doubles, and instance_doubles are doubles that increase in their power of specificity in that order. So a double is more specific than a spy and an instance_double is more specific than a double.</p>
  </li>
</ol>

<p>The best way to demonstrate how they work is to pry into an rspec file.  This assumes that you are already familiar with setting up an Rspec test file in a Rails app. In the Rspec file, inside an “it” block place a binding.pry.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    it "demonstrates doubles" do
      binding.pry
    end
</code></pre>
</div>

<p>In the pry session, define a spy, then try to call undefined methods on it.  It will keep returning a double.  So spies, are just generic doubles that will keep giving you a double no matter what methods you call on them.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pry(#&lt;RSpec&gt;)&gt; s=spy
=&gt; #&lt;Double (anonymous)&gt;
pry(#&lt;RSpec&gt;)&gt; s.what?
=&gt; #&lt;Double (anonymous)&gt;
pry(#&lt;RSpec&gt;)&gt; s.anything?
=&gt; #&lt;Double (anonymous)&gt;
</code></pre>
</div>

<p>Moving towards more specificity, define a double.  Below a double is defined with a method called name that returns the string “androidgrl”.  When we call name on the double it returns “androidgrl”.  What happens when we call an undefined method like “age” on the double?  It gives us an error unlike with spies.  So with doubles, you have to define methods that can be called on them.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pry(#&lt;RSpec&gt;)&gt; d=double(name: "androidgrl")
=&gt; #&lt;Double (anonymous)&gt;
pry(#&lt;RSpec&gt;)&gt; d.name
=&gt; "androidgrl"
pry(#&lt;RSpec&gt;)&gt; d.age
RSpec::Mocks::MockExpectationError: #&lt;Double (anonymous)&gt; received unexpected message :age with (no args)
from /opt/active/acl_api/current/vendor/bundle/ruby/2.1.0/gems/rspec-support-3.3.0/lib/rspec/support.rb:86:in `block in &lt;module:Support&gt;'
</code></pre>
</div>

<p>And finally, we have the most specific type of double, instance_doubles.  Here we have to specify which Class we’re defining the double for.  This has to be an actual class that exists either in your application or inherited through Ruby.  Here we’re stubbing out the “count” method on the Array class to always return 3.  Notice that when we try to define a method on Array that doesn’t actually exist we get an error.  Also when we try to make an instance double for a Class that doesn’t exist we get an error.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pry(#&lt;RSpec&gt;)&gt; i=instance_double(Array, count: 3)
=&gt; #&lt;InstanceDouble(Array) (anonymous)&gt;
pry(#&lt;RSpec&gt;)&gt; i.count
=&gt; 3
pry(#&lt;RSpec&gt;)&gt; i=instance_double(Array, whatever: "?")
RSpec::Mocks::MockExpectationError: the Array class does not implement the instance method: whatever
from /opt/active/acl_api/current/vendor/bundle/ruby/2.1.0/gems/rspec-support-3.3.0/lib/rspec/support.rb:86:in `block in &lt;module:Support&gt;'
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>pry(#&lt;RSpeci=instance_double(FakeClass, fake_method: "fake")
NameError: uninitialized constant TM::FakeClass
from (pry):14:in `block (2 levels) in &lt;module:TM&gt;'
</code></pre>
</div>

<p>In summary:</p>

<ol>
  <li>
    <p>Instance_doubles have to be defined on Classes that actually exist in your code and you can only stub methods that actually exist.</p>
  </li>
  <li>
    <p>Doubles can have any methods called on them as long as you define them in the double.</p>
  </li>
  <li>
    <p>Spies don’t need to have anything defined on them and will always return a double.</p>
  </li>
</ol>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page3">Older</a>
  
  
    
      <a class="pagination-item newer" href="/">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
